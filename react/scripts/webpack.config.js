"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _path=_interopRequireDefault(require("path"));var _webpack=_interopRequireDefault(require("webpack"));var _htmlWebpackPlugin=_interopRequireDefault(require("html-webpack-plugin"));var _miniCssExtractPlugin=_interopRequireDefault(require("mini-css-extract-plugin"));var _terserWebpackPlugin=_interopRequireDefault(require("terser-webpack-plugin"));var _circularDependencyPlugin=_interopRequireDefault(require("circular-dependency-plugin"));var _webpackbar=_interopRequireDefault(require("webpackbar"));var _friendlyErrorsWebpackPlugin=_interopRequireDefault(require("@soda/friendly-errors-webpack-plugin"));var _reactRefreshWebpackPlugin=_interopRequireDefault(require("@pmmmwh/react-refresh-webpack-plugin"));var _cssoWebpackPlugin=_interopRequireDefault(require("csso-webpack-plugin"));var _config=_interopRequireDefault(require("./config"));var _webpack2=require("./webpack.utils");var rules=(0,_webpack2.getRules)(_config["default"]);var loaders=(0,_webpack2.getLoaders)(_config["default"]);var _default={mode:_config["default"].MODE,entry:_path["default"].join(_config["default"].APP_SRC,"index.tsx"),output:{filename:"index.js",path:_config["default"].paths.js,chunkFilename:"[id].[chunkhash].js"},resolve:{extensions:[".js",".jsx",".ts",".tsx",".css",".sass",".scss",".json"],alias:_config["default"].alias},target:"web",devtool:_config["default"].__DEV__?"inline-source-map":false,devServer:_config["default"].__DEV__?{"static":{directory:_path["default"].join(_config["default"].APP_ROOT,"public")},client:{logging:"none",overlay:false},compress:true,hot:_config["default"].isServerRunning,port:_config["default"].port,historyApiFallback:true,devMiddleware:{writeToDisk:false}}:{},stats:_config["default"].isServerRunning?"none":"detailed",optimization:_config["default"].__PROD__?{nodeEnv:_config["default"].MODE,minimize:true,minimizer:[new _terserWebpackPlugin["default"]({exclude:/node_modules/,extractComments:false,terserOptions:{parse:{html5_comments:false},mangle:true,sourceMap:false,compress:{defaults:true,drop_console:false,keep_infinity:true,passes:2},format:{comments:false,preamble:null,quote_style:3,preserve_annotations:false,ecma:2020},ecma:2020,keep_classnames:false,keep_fnames:false,safari10:false}})]}:{},module:{rules:[{test:/\.ts(x?)$/i,exclude:/node_modules/,use:loaders.tsx},{test:/\.js$/i,exclude:/node_modules/,use:loaders.js},{test:/\.module\.s[ac]ss$/i,use:[loaders.styleOrExtractCss,loaders.cssModules,loaders.postCss,loaders.sass]},{test:/\.s[ac]ss$/i,exclude:/\.module\.s[ac]ss$/i,use:[loaders.styleOrExtractCss,loaders.css,loaders.postCss,loaders.sass]},{test:/\.module\.css$/i,use:[loaders.styleOrExtractCss,loaders.cssModules,loaders.postCss]},{test:/\.css$/i,use:[loaders.styleOrExtractCss,loaders.css,loaders.postCss],exclude:/\.module\.css$/i},rules.images,rules.svg]},plugins:[new _webpack["default"].DefinePlugin({__DEV__:_config["default"].__DEV__,__PROD__:_config["default"].__PROD__}),new _circularDependencyPlugin["default"]({exclude:/node_modules/,include:/react-hook-form/,failOnError:true,allowAsyncCycles:false,cwd:_config["default"].APP_ROOT}),new _friendlyErrorsWebpackPlugin["default"],new _webpackbar["default"]({}),_config["default"].isServerRunning&&new _htmlWebpackPlugin["default"]({template:_path["default"].join(_config["default"].APP_ROOT,"public/index.html")}),_config["default"].isServerRunning&&new _reactRefreshWebpackPlugin["default"]({overlay:false}),(_config["default"].__PROD__||_config["default"].__DEV__&&!_config["default"].isServerRunning)&&new _miniCssExtractPlugin["default"]({filename:"".concat(_config["default"].paths.css,"/index.css")}),_config["default"].__PROD__&&new _cssoWebpackPlugin["default"]({comments:false})].filter(Boolean)};exports["default"]=_default;